{"openapi":"3.1.0","info":{"title":"AI Smart Investment Advisor","version":"0.1.0"},"paths":{"/api/auth/login":{"post":{"tags":["auth"],"summary":"Login Access Token","description":"用户登录接口 (获取 Access Token)\n1. 验证邮箱和密码\n2. 生成 JWT Token","operationId":"login_access_token_api_auth_login_post","requestBody":{"content":{"application/x-www-form-urlencoded":{"schema":{"$ref":"#/components/schemas/Body_login_access_token_api_auth_login_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Token"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/register":{"post":{"tags":["auth"],"summary":"Register User","description":"用户注册接口\n1. 检查邮箱是否已存在\n2. 创建新用户并加密密码\n3. 自动登录 (返回 Token)","operationId":"register_user_api_auth_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Token"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/portfolio/search":{"get":{"tags":["portfolio"],"summary":"Search Stocks","description":"股票搜索接口\n- 同时支持本地数据库模糊搜索和远程 API 实时搜索\n- 如果本地没搜到且开启了 remote=True，会尝试从第三方源抓取并同步到本地","operationId":"search_stocks_api_portfolio_search_get","parameters":[{"name":"query","in":"query","required":false,"schema":{"type":"string","default":"","title":"Query"}},{"name":"remote","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"Remote"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/SearchResult"},"title":"Response Search Stocks Api Portfolio Search Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/portfolio/":{"get":{"tags":["portfolio"],"summary":"Get Portfolio","description":"获取当前用户的投资组合列表\n- 使用 outerjoin 一次性查出持仓量、最新价、基本面和技术指标\n- 如果 refresh=True，会触发后台并行更新所有持仓的实时行情","operationId":"get_portfolio_api_portfolio__get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"refresh","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"Refresh"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/PortfolioItem"},"title":"Response Get Portfolio Api Portfolio  Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"tags":["portfolio"],"summary":"Add Portfolio Item","description":"添加或更新自选股/持仓","operationId":"add_portfolio_item_api_portfolio__post","security":[{"OAuth2PasswordBearer":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PortfolioCreate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/portfolio/{ticker}":{"delete":{"tags":["portfolio"],"summary":"Delete Portfolio Item","description":"从自选股中删除","operationId":"delete_portfolio_item_api_portfolio__ticker__delete","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"ticker","in":"path","required":true,"schema":{"type":"string","title":"Ticker"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/portfolio/{ticker}/refresh":{"post":{"tags":["portfolio"],"summary":"Refresh Stock Data","description":"针对单个股票的手动强制刷新接口","operationId":"refresh_stock_data_api_portfolio__ticker__refresh_post","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"ticker","in":"path","required":true,"schema":{"type":"string","title":"Ticker"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/portfolio/{ticker}/news":{"get":{"tags":["portfolio"],"summary":"Get Stock News","description":"获取该股票在数据库中存储的最新新闻","operationId":"get_stock_news_api_portfolio__ticker__news_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"ticker","in":"path","required":true,"schema":{"type":"string","title":"Ticker"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/analysis/{ticker}":{"post":{"tags":["analysis"],"summary":"Analyze Stock","description":"股票分析接口 (核心业务逻辑)\n1. 检查用户权限/SaaS限制 (免费用户每日限额)\n2. 获取实时行情数据 (价格、技术指标)\n3. 获取相关新闻 (上下文)\n4. 获取用户持仓信息 (成本、盈亏)\n5. 调用 AI 模型生成投资建议","operationId":"analyze_stock_api_analysis__ticker__post","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"ticker","in":"path","required":true,"schema":{"type":"string","title":"Ticker"}},{"name":"force","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"Force"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AnalysisResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"get":{"tags":["analysis"],"summary":"Get Latest Analysis","description":"获取单支股票最新的分析记录（不触发新 AI 分析，仅查库）","operationId":"get_latest_analysis_api_analysis__ticker__get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"ticker","in":"path","required":true,"schema":{"type":"string","title":"Ticker"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AnalysisResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/user/me":{"get":{"tags":["user"],"summary":"Read Users Me","operationId":"read_users_me_api_user_me_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserProfile"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/api/user/settings":{"put":{"tags":["user"],"summary":"Update User Settings","operationId":"update_user_settings_api_user_settings_put","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserSettingsUpdate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserProfile"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/health":{"get":{"summary":"Health Check","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/":{"get":{"summary":"Root","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"AnalysisResponse":{"properties":{"ticker":{"type":"string","title":"Ticker"},"analysis":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Analysis"},"sentiment_score":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Sentiment Score"},"summary_status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Summary Status"},"risk_level":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Risk Level"},"technical_analysis":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Technical Analysis"},"fundamental_news":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Fundamental News"},"action_advice":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Action Advice"},"investment_horizon":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Investment Horizon"},"confidence_level":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Confidence Level"},"immediate_action":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Immediate Action"},"target_price":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Target Price"},"stop_loss_price":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Stop Loss Price"},"is_cached":{"type":"boolean","title":"Is Cached","default":false},"model_used":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Model Used"},"created_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Created At"}},"type":"object","required":["ticker"],"title":"AnalysisResponse"},"Body_login_access_token_api_auth_login_post":{"properties":{"grant_type":{"anyOf":[{"type":"string","pattern":"^password$"},{"type":"null"}],"title":"Grant Type"},"username":{"type":"string","title":"Username"},"password":{"type":"string","format":"password","title":"Password"},"scope":{"type":"string","title":"Scope","default":""},"client_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Client Id"},"client_secret":{"anyOf":[{"type":"string"},{"type":"null"}],"format":"password","title":"Client Secret"}},"type":"object","required":["username","password"],"title":"Body_login_access_token_api_auth_login_post"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"PortfolioCreate":{"properties":{"ticker":{"type":"string","title":"Ticker"},"quantity":{"type":"number","title":"Quantity"},"avg_cost":{"type":"number","title":"Avg Cost"}},"type":"object","required":["ticker","quantity","avg_cost"],"title":"PortfolioCreate"},"PortfolioItem":{"properties":{"ticker":{"type":"string","title":"Ticker"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"},"quantity":{"type":"number","title":"Quantity"},"avg_cost":{"type":"number","title":"Avg Cost"},"current_price":{"type":"number","title":"Current Price","default":0.0},"market_value":{"type":"number","title":"Market Value","default":0.0},"unrealized_pl":{"type":"number","title":"Unrealized Pl","default":0.0},"pl_percent":{"type":"number","title":"Pl Percent","default":0.0},"last_updated":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Updated"},"sector":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Sector"},"industry":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Industry"},"market_cap":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Market Cap"},"pe_ratio":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Pe Ratio"},"forward_pe":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Forward Pe"},"eps":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Eps"},"dividend_yield":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Dividend Yield"},"beta":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Beta"},"fifty_two_week_high":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Fifty Two Week High"},"fifty_two_week_low":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Fifty Two Week Low"},"rsi_14":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Rsi 14"},"ma_20":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Ma 20"},"ma_50":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Ma 50"},"ma_200":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Ma 200"},"macd_val":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Macd Val"},"macd_signal":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Macd Signal"},"macd_hist":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Macd Hist"},"macd_hist_slope":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Macd Hist Slope"},"bb_upper":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Bb Upper"},"bb_middle":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Bb Middle"},"bb_lower":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Bb Lower"},"atr_14":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Atr 14"},"k_line":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"K Line"},"d_line":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"D Line"},"j_line":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"J Line"},"volume_ma_20":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Volume Ma 20"},"volume_ratio":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Volume Ratio"},"adx_14":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Adx 14"},"pivot_point":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Pivot Point"},"resistance_1":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Resistance 1"},"resistance_2":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Resistance 2"},"support_1":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Support 1"},"support_2":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Support 2"},"change_percent":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Change Percent","default":0.0}},"type":"object","required":["ticker","quantity","avg_cost"],"title":"PortfolioItem"},"SearchResult":{"properties":{"ticker":{"type":"string","title":"Ticker"},"name":{"type":"string","title":"Name"}},"type":"object","required":["ticker","name"],"title":"SearchResult"},"Token":{"properties":{"access_token":{"type":"string","title":"Access Token"},"token_type":{"type":"string","title":"Token Type"}},"type":"object","required":["access_token","token_type"],"title":"Token"},"UserCreate":{"properties":{"email":{"type":"string","format":"email","title":"Email"},"password":{"type":"string","title":"Password"}},"type":"object","required":["email","password"],"title":"UserCreate"},"UserProfile":{"properties":{"id":{"type":"string","title":"Id"},"email":{"type":"string","title":"Email"},"membership_tier":{"type":"string","title":"Membership Tier"},"has_gemini_key":{"type":"boolean","title":"Has Gemini Key"},"has_deepseek_key":{"type":"boolean","title":"Has Deepseek Key"},"has_siliconflow_key":{"type":"boolean","title":"Has Siliconflow Key"},"preferred_data_source":{"type":"string","title":"Preferred Data Source"},"preferred_ai_model":{"type":"string","title":"Preferred Ai Model"}},"type":"object","required":["id","email","membership_tier","has_gemini_key","has_deepseek_key","has_siliconflow_key","preferred_data_source","preferred_ai_model"],"title":"UserProfile"},"UserSettingsUpdate":{"properties":{"api_key_gemini":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Api Key Gemini"},"api_key_deepseek":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Api Key Deepseek"},"api_key_siliconflow":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Api Key Siliconflow"},"preferred_data_source":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Preferred Data Source"},"preferred_ai_model":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Preferred Ai Model"}},"type":"object","title":"UserSettingsUpdate"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"OAuth2PasswordBearer":{"type":"oauth2","flows":{"password":{"scopes":{},"tokenUrl":"/api/auth/login"}}}}}}