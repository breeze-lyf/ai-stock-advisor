# 产品需求文档 (PRD) - AI 智能投顾助手 (AI Smart Investment Advisor)

**版本号：** v1.0
**状态：** 规划中
**核心目标：** 为个人投资者提供基于实时数据与大模型深度分析的辅助决策工具，通过“MCP 数据获取 + LLM 深度解读”的模式，降低投研门槛。

---

## 1. 产品概述 (Executive Summary)

本产品是一个 Web 端应用，允许用户管理自选股列表，记录持仓成本。系统通过后端 Python 服务（MCP 逻辑）获取实时/盘前股价、技术指标与新闻，用户可手动触发 AI 分析，获得关于“买卖点、持仓风险、市场情绪”的深度建议。

**核心价值：**

- **省时：** 自动聚合数据，无需在新闻App和看盘软件间切换。
- **降本：** 使用用户自己的 API Key，且通过“手动触发”机制控制 Token 消耗。
- **易懂：** AI 将复杂的 K 线和指标翻译成“人话”建议。

---

## 2. 用户画像 (User Persona)

- **初级/中级投资者：** 懂一点股票，但看不懂复杂的财报和深奥的技术指标。
- **上班族：** 没时间时刻盯盘，希望在盘前或收盘后快速获得高质量的决策参考。
- **SaaS 潜在用户：** 愿意为“节省时间”和“高质量信息”付费。

---

## 3. 功能需求详情 (Functional Requirements)

### 3.1 账户与权限体系

- **注册/登录：** 邮箱 + 密码（未来支持 Google/微信登录）。
- **API Key 管理：** 用户需在“设置”页面填入自己的 Gemini 或 DeepSeek API Key（数据加密存储，仅在后端调用时解密）。
- **会员体系 (SaaS 基础)：**
    - **普通用户：** 每日限制 3 次 AI 深度分析。
    - **Pro 会员：** 无限次分析（或更高额度），解锁更多高级指标。

### 3.2 仪表盘 (Dashboard) - "早报模式"

用户选择 B 方案（早报模式），因此首页不仅仅是表格。

- **市场概览：** 顶部显示大盘指数（标普500/纳指/上证）的当日涨跌。
- **重点关注卡片：**
    - 展示自选股中**涨跌幅最大**的前 3 只股票。
    - 展示**持仓盈亏变动最大**的 1 只股票。
- **AI 早报摘要区：** 显示一个“生成今日早报”的按钮（手动触发），点击后 AI 会扫描自选股的简单行情，生成一段 200 字的市场情绪总结（不消耗深度分析额度）。

### 3.3 股票行情与数据 (MCP/Data Layer)

后端通过 Python (`yfinance` 或 `akshare`) 获取数据。

- **实时性策略：**
    - 页面在前台激活时，每 10-15 秒轮询一次价格。
    - 页面休眠（Tab 切换走）时停止轮询。
    - 提供显著的“手动刷新”按钮。
    - **盘前/盘后支持：** 必须展示 Pre-market/After-hours 价格，因为美股盘前波动很大。
- **核心展示指标 (针对非专业投资者)：**
    - **价格与涨跌：** Price, Change, Change%
    - **情绪指标 (RSI)：** 相对强弱指数。前端用颜色条展示（<30 超卖/绿色，>70 超买/红色）。
    - **趋势指标 (MA20)：** 股价在 20 日均线上方（强势）还是下方（弱势）。
    - **热度 (Vol/AvgVol)：** 今日量比。如果量比 > 2，说明有大事发生，高亮提示。
    - MACD指标

### 3.4 深度分析功能 (The Core)

这是产品的核心壁垒。

- **触发方式：** 在个股详情页或列表旁，点击“⚡️ 深度分析”按钮。
- **数据投喂 (Context)：** 系统将打包以下数据发给 LLM：
    1. **实时数据：** 现价、涨跌、盘前价格。
    2. **技术指标：** RSI, MA5/10/20, MACD (后端计算好数值传给 AI)。
    3. **消息面：** 最近 3-5 条新闻标题及摘要。
    4. **用户持仓：** 成本价、持仓数、当前浮动盈亏。
- **AI 输出结构 (Prompt Engineering)：**
    - **状态诊断：** “目前该股处于（强势/弱势/震荡）阶段。”
    - **持仓建议：** “你目前的持仓浮盈 15%，鉴于 RSI 已超买，建议考虑**分批止盈**，卖出 1/3。” 或者 “你目前亏损 5%，但基本面未变，建议**持股观望**。”
    - **风险提示：** “注意，今晚该股将发布财报，波动风险极大。”

### 3.5 头寸管理 (Position Management)

- **录入模式：** 简单版。
    - 输入：股票代码 (Ticker)、持股数量 (Quantity)、平均成本 (Avg Cost)。
- **自动计算：**
    - 持仓市值 (Market Value) = 现价 × 数量
    - 浮动盈亏 (Unrealized P&L) = (现价 - 成本) × 数量
    - 盈亏比例 (P&L %)

---

## 4. 技术架构 (Technical Architecture)

- **前端 (Frontend):** Next.js (React) + Tailwind CSS (快速构建漂亮的 UI) + ShadcnUI (组件库)。
- **后端 (Backend):** Python (FastAPI)。
    - FastAPI 性能极高，且原生支持异步（Async），非常适合同时处理 HTTP 请求和调用 AI 接口。
    - **Stock Libs:** `yfinance` (美股), `akshare` (A股), `pandas-ta` (计算技术指标).
- **AI 接口层:** LangChain (Python版) 或直接调用 Gemini/DeepSeek SDK。
- **数据库:** PostgreSQL (存储用户信息、自选股关系、历史分析记录)。
- **缓存:** Redis (可选，用于缓存 1 分钟内的股价，防止过多请求被 yfinance 封禁)。

---

## 5. 核心页面流程 (User Journey)

1. **Dashboard:** 用户打开 -> 看到自选股列表红绿跳动 -> 看到 NVDA 盘前跌了 3%。
2. **发现问题:** 用户觉得 NVDA 跌得有点多，想知道原因。
3. **触发分析:** 点击 NVDA 卡片上的“深度分析” -> 弹窗提示“消耗 1 次额度” -> 确认。
4. **后端处理:** Python 拉取 NVDA 的 RSI (35, 偏低) 和最近新闻 (“英伟达推迟发布新芯片”) -> 结合用户成本 ($120) -> 发送给 Gemini。
5. **获取结果:** 3-5 秒后，页面展示分析报告：
    - *“受推迟发布新闻影响，情绪恐慌。但技术面接近超卖区，且你的成本较低 ($120)，安全垫足够。建议不要恐慌抛售，若跌至 $130 可考虑补仓。”*

---

## 6. 开发路线图 (Roadmap)

### 第一阶段：MVP (最小可行性产品)

- [ ]  搭建 FastAPI + Next.js 框架。
- [ ]  实现 `yfinance` 数据获取接口（价格、RSI、MA）。
- [ ]  完成简单的头寸录入（增删改查）。
- [ ]  对接 Gemini API，跑通“点击 -> 分析 -> 显示文本”流程。
- [ ]  部署上线（本地或服务器）。

### 第二阶段：SaaS 化

- [ ]  增加用户注册/登录系统。
- [ ]  增加 API Key 加密存储功能。
- [ ]  实现“每日分析次数限制”逻辑。

### 第三阶段：增强与收费

- [ ]  接入 Stripe/微信支付。
- [ ]  增加“早报”功能（批量扫描）。
- [ ]  引入 DeepSeek 模型作为备选。